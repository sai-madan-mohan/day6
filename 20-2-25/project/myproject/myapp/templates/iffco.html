{% extends 'admin_base.html' %}
{% load static %}
{% load pagination_tags %}
{% block title %}Admin | {{block.super}}{% endblock %}
{% block content %}


            <div class="content-page">
                <div class="content">
                    <div class="container-fluid">

                        <div class="row">
                            <div class="col-xl-12">
                                <div class="page-title-box">
                                    <h4 class="page-title float-left">  Iffco </h4>

                                    <ol class="breadcrumb float-right">
                                        
                                        <li class="breadcrumb-item active">  Progress Report</li>
                                    </ol>

                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>

                        {% if messages %}
                            {% for message in messages %}
							{% if message.tags == 'success' %}
                                <div class="alert alert-success">{{ message }}</div>
							{% else %}
								<div class="alert alert-danger">{{ message }}</div>
							{% endif %}
                            {% endfor %}
                        {% endif %}

						<div class="row">
                            <div class="col-md-12">



                            <form action="{% url 'yoshimitsujpinfy:admin_iffco' %}" method="get">

                                {% csrf_token %}

								<div class="row m-b-20">
                                   <div class=" col-md-4">

						        <select class="form-control  selectCourse " style="width:100%;" id="searchedCourseId" name="searchedCourseId">

										<option></option>


								 </select>
								</div>
			


							<div class="col-md-4">

								  <button type="submit" class="btn btn-primary  btn-sm" ><i class="fa fa-search"></i> Search</button>

                                

								  </select>
							</div>

								</div>

                            </form>
                            <form action="{% url 'yoshimitsujpinfy:admin_iffco' %}" method="get" enctype="multipart/form-data" id="search_form">

                            <div class="row m-b-20">

                                <div class="col-md-3">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text">From Date <span class="text-red">*</span></div>
                                        </div>
                                        {% if report_from_date %}
                                        <input type="text" class="form-control datepicker-autoclose" placeholder="mm/dd/yyyy"
                                               value="{{ report_to_date }}" id="enrollment_to_request_date" name="enrollment_to_request_date" required>
                                        {% else %}
                                        <input type="text" class="form-control datepicker-autoclose" placeholder="mm/dd/yyyy"
                                               id="enrollment_to_request_date" name="enrollment_to_request_date" required>
                                        {% endif %}
                                    </div>
                                </div>
                                
                               
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-primary  btn-sm" ><i class="fa fa-search"></i> Search</button>
                                   
                                </div>

                            </div>

                        </form>

                


{% if userCourses.object_list|length > 0 %}
									<div class="table-responsive">
					<table class="table table-bordered  table-sm" width="100%" >

							<thead class="thead-light">

							<tr>
								<th style="width: 15%;">Course Name</th>
                                <th style="width: 5%;">Start Date</th>
                                <th style="width: 5%;">Student Name</th>
                                <th style="width: 5%;">Total Session Happened</th>
								<th style="width: 5%;">Total Session Attended</th>
                                <th style="width: 5%;">Attendance Percentage</th>
                                <th style="width: 5%;">No.of Assignment Assigned</th>
                                <th style="width: 5%;" >No.of Assignment Attempted</th>
                                <th style="width: 5%;">No.of Assessment Assigned</th>
                                <th style="width: 5%;">No.of Assessment Attempted</th>
                                <th style="width: 5%;">Total Course Assigned</th>
                                <th style="width: 5%;">Overall Rating</th>
                                
							</tr>
							</thead>
							<tbody>

                            {% for usercourse in userCourses.object_list %}

                            <tr>
                                <td>{{ usercourse.course.name }}</td>
                                <td>{{ usercourse.batch.live_class_from|date:'d M Y' }}</td>
                                <td>{{ usercourse.user.first_name }} {{ usercourse.user.last_name }}</td>
                                
							</tr>

                            {% endfor %}

							</tbody>
						</table>

<!--                                pagination starts -->


                        <div class="text-center mb-3">
                           <div class="course-pagination ">
                              <ul class="pagination">
                                {% autoescape off %}
								{% paginate_with_params userCourses %}
                                {% endautoescape %}
                                </ul>
                           </div>
                        </div>
<!--                                pagination ends -->
					</div>
                    {% else %}
                    <h6 class="m-t-30 m-b-30 text-center">  <i class="fa fa-warning text-warning"></i> <span class="text-muted">No data available.</span></h6>
                    {% endif %}
									</div>




                                </div>
                            </div>
                        </div>

					</div>





            </div>


<!-- bulk upload modal starts -->

                           <div class="modal fade" id="BulkUploads" role="dialog" aria-labelledby="BulkUploadsLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="BulkUploadsLabel"> Bulk Enrolled Users</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>

                                            <form action="{% url 'yoshimitsujpinfy:admin_bulk_user_enrolled' %}" method="post" enctype="multipart/form-data">

                                                {% csrf_token %}

                                                <div class="modal-body">
												<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Course Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  selectCourse" style="width:100%;" id="bulkcourses" name="bulkcourses" required exclude-one-to-one="1">

                                                    <option value=""></option>

                                        </select>


                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="BatchName" class="col-lg-3 col-form-label">Batch Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                            <select class="form-control" id="bulkselectedBatchId" name="bulkselectedBatchId" disabled>
                                                <option value="">Please select course first</option>
                                            </select>
                                        </div>
                                    </div>
									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Select File ( .CSV ) <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<div class="custom-file">
												  <input type="file" class="custom-file-input" id="customFile" name="filename" required>
												  <label class="custom-file-label" for="customFile">Choose file</label>
												</div>
                                          <div title="File Sample" class="mt-2"><a href="{% static 'adminassets/student_sample_file.csv' %}" target="_blank"><i class="fa fa-file"></i> Download sample file</a></div>


                                        </div>
                                    </div>



									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Payment Status <span class="text-red">*</span></label>
                                        <div class="col-lg-4">
										<select class="form-control" name="paymentbulk">


												 <option value="0">Paid</option>
												<option value="1">Not Paid</option>

											  </select>


                                        </div>
                                        <div class="col-lg-4">
                                            <label for="notify_students" class="col-lg-3 col-form-label">Notify</label>
                                            <input type="checkbox" name="notify_students" id="notify_students">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="is_kid" class="col-lg-3 col-form-label">Infynikids website user?</label>
                                        <div class="col-lg-8">
                                            <input type="checkbox" name="is_kid" id="is_kid">
                                        </div>
                                    </div>


                                        </div>
                                                <div class="modal-footer">

                                                    <button type="submit" class="btn btn-primary" id="bulkenrollbtn"> Enroll Now</button>
						    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                                                </div>

                                            </form>

                                            </div>
                                        </div>
                                    </div>


<!-- bulk upload modal ends -->


	<!--add user enrolled Modal starts  -->

                                    <div class="modal fade" id="AddEnrolledUser" role="dialog" aria-labelledby="AddEnrolledUserLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="AddEnrolledUserLabel"> Add Enrolled User</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>

                                            <form action="{% url 'yoshimitsujpinfy:admin_user_enrolled_course' %}" method="post">

                                                {% csrf_token %}

                                                <div class="modal-body">
												<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Course Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  selectCourse" style="width:100%;" id="SelectedCourseId" name="SelectedCourseId" required>

                                                    <option></option>

                                             </select>


                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="BatchName" class="col-lg-3 col-form-label">Batch Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                            <select class="form-control" id="selectedBatchId" name="selectedBatchId" disabled>
                                                <option value="">Please select course first</option>
                                            </select>
                                        </div>
                                    </div>
									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Student Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  selectemail" style="width:100%;"  name="selectedStudentid" required>

                                                    <option value=""></option>

                                             </select>


                                        </div>
                                    </div>

									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Payment Status <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control" id="enrolltype" name="enrolltype">
                                                <option value="1">Paid</option>
                                                <option value="0">Not Paid</option>

											  </select>


                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="is_kid" class="col-lg-3 col-form-label">Infynikids website user?</label>
                                        <div class="col-lg-8">
                                            <input type="checkbox" name="is_kid" id="is_kid">
                                        </div>
                                    </div>


                                        </div>
                                                <div class="modal-footer">

                                                    <button type="submit" class="btn btn-primary" id="enrollbtn"> Enroll User</button>
						    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                                                </div>

                                            </form>

                                            </div>
                                        </div>
                                    </div>

    <!--add user enrolled modal ends    -->



<!-- edit user enrolled modal starts -->

                        {% for usercourse in userCourses.object_list %}

									<div class="modal fade" id="EditEnrolledUser{{ usercourse.id }}" role="dialog" aria-labelledby="EditEnrolledUserLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="EditAddEnrolledUserLabel"> Edit Enrolled User</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>

                                          <form action="{% url 'yoshimitsujpinfy:admin_edit_enrollment' usercourse.id %}" method="post">

                                              {% csrf_token %}

                                                <div class="modal-body">
												<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Course Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  editCourse" style="width:100%;" disabled>

                                                    <option></option>
                                                        <option value="{{ usercourse.course.id }}" selected>{{ usercourse.course.name }} - {{ usercourse.course.id }}</option>

                                             </select>


                                        </div>
                                    </div>
												<div class="form-group row">
                                        <label for="BatchName" class="col-lg-3 col-form-label">Batch Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
												<input type="text" class="form-control" value="{{ usercourse.batch.name }}" readonly>


                                        </div>
                                    </div>
									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Student Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  selectInstructor" style="width:100%;" disabled>

                                                    <option></option>
                                                        <option value="{{ usercourse.user.id }}" selected>{{ usercourse.user.first_name }} {{ usercourse.user.last_name }} ({{ usercourse.user.email }})</option>
                                             </select>


                                        </div>
                                    </div>

<!--									<div class="form-group row">-->
<!--                                        <label for="SessionTime" class="col-lg-3 col-form-label">Add Date & Time <span class="text-red">*</span></label>-->
<!--                                        <div class="col-lg-4">-->

<!--											  <div class="input-group">-->
<!--											<div class="input-group-prepend">-->
<!--											  <div class="input-group-text"> Date <span class="text-red">*</span></div>-->
<!--											</div>-->
<!--                                                            <input type="text" class="form-control datepicker-autoclose" placeholder="mm/dd/yyyy">-->

<!--                                                        </div>-->



<!--                                        </div>-->

<!--                                        <div class="col-lg-4">-->


<!--											  <div class="input-group">-->
<!--											<div class="input-group-prepend">-->
<!--											  <div class="input-group-text"> Time <span class="text-red">*</span></div>-->
<!--											</div>-->
<!--                                                            <input type="text" class="form-control timepicker" value="11:45 AM">-->

<!--                                                        </div>-->


<!--                                        </div>-->
<!--                                    </div>-->

<!--                                                    -->
									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Payment Status <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control" id="enrollmentselect" name="enrollmentselect">

                                            {% if usercourse.is_paid_enrollment %}
                                                <option value="1" selected>Paid</option>
                                                <option value="0" >Not Paid</option>
                                            {% else %}
                                                <option value="0" selected>Not Paid</option>
                                                <option value="1">Paid</option>
											{% endif %}


											  </select>


                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="EnrollmentEndDate" class="col-lg-3 col-form-label">Enrollment End Date </label>
                                        <div class="col-lg-8">
        <!-- Display placeholder text if no date is selected -->
                                                <input type="date" class="form-control" id="EnrollmentEndDate" name="enroll_end_date"
                                                {% if usercourse.end_date %}
               value="{{usercourse.end_date|date:'Y-m-d'}}"
               {% else %}
               placeholder="dd-mm-yyyy"
               {% endif %}
               min="{{ min_date }}"
               max="{{ max_date }}">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="AllowEnrollmentStartDate" class="col-lg-3 col-form-label">Allow Enrollment Start Date </label>
                                        <div class="col-lg-8">
                                            <input type="date" class="form-control" id="AllowEnrollmentStartDate" name="allow_enroll_start_date"
                                                placeholder="mm/dd/yyyy" {% if usercourse.allow_enrollment_start_date %}
                                                value="{{usercourse.allow_enrollment_start_date|date:'Y-m-d'}}" {% endif %}
                                                min="{{ usercourse.batch.live_class_from|date:'Y-m-d' }}"
                                                max="{{ usercourse.batch.live_class_to|date:'Y-m-d' }}">
                                        </div>
                                    </div>

                                        </div>
                                                <div class="modal-footer">

                                                    <button type="submit" class="btn btn-primary"> Save</button>
						    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                                                </div>

                                         </form>

                                            </div>
                                        </div>
                                    </div>

                        {% endfor %}

<!--edit user enrolled modal ends -->


	<!--register and enrolled Modal starts  -->

                                    <div class="modal fade" id="RegisterAndEnroll" role="dialog" aria-labelledby="AddEnrolledUserLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-lg" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="AddEnrolledUserLabel"> Register and Enroll User</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>

                                            <form action="{% url 'yoshimitsujpinfy:admin_register_and_enroll_user' %}" method="post">

                                                {% csrf_token %}

                                                <div class="modal-body">
												<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Course Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control  selectCourse" style="width:100%;" id="re_SelectedCourseId" name="re_SelectedCourseId" required>

                                                    <option></option>

                                             </select>


                                        </div>
                                    </div>
												<div class="form-group row">
                                        <label for="BatchName" class="col-lg-3 col-form-label">Batch Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                                <select class="form-control" id="re_selectedBatchId" name="re_selectedBatchId" required>
                                                    <option>Please select course first</option>
                                                </select>
                                        </div>
                                    </div>
									<div class="form-group row">
                                        <label for="FirstName" class="col-lg-3 col-form-label">First Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                          <input type="text" class="form-control " id="re_first_name" name="re_first_name" required>

                                        </div>
                                    </div>
									<div class="form-group row">
                                        <label for="LastName" class="col-lg-3 col-form-label" >Last Name <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                          <input type="text" class="form-control " id="re_last_name" name="re_last_name" required>

                                        </div>
                                    </div>
								<div class="form-group row">
                                        <label for="EmailAddress" class="col-lg-3 col-form-label">Email Address <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                          <input type="email" class="form-control " id="re_email" name="re_email" required>

                                        </div>
                                    </div>
                                <div class="form-group row">
                                        <label for="PhoneNumber" class="col-lg-3 col-form-label">Phone Number <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
                                          <input type="tel" class="form-control " id="re_mobile" name="re_mobile" minlength="10"
                                     onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57" maxlength="10" required>

                                        </div>
                                    </div>

									<div class="form-group row">
                                        <label for="InstructorName" class="col-lg-3 col-form-label">Payment Status <span class="text-red">*</span></label>
                                        <div class="col-lg-8">
										<select class="form-control" id="re_enrolltype" name="re_enrolltype">
                                                <option value="1">Paid</option>
                                                <option value="0">Not Paid</option>

											  </select>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                       <label for="SalesPersonEmail" class="col-lg-3 col-form-label">Sales Person Email</label>
                                       <div class="col-lg-8">
                                        <input type="email" class ="form-control" id="re_sales_person_email" name="re_sales_person_email">
                                       </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="SalesManagerEmail" class="col-lg-3 col-form-label">Sales Manager Email</label>
                                        <div class="col-lg-8">
                                         <input type="email" class ="form-control" id="re_sales_manager_email" name="re_sales_manager_email">
                                        </div>
                                     </div>

                                    <div class="form-group row">
                                        <label for="is_kid" class="col-lg-3 col-form-label">Infynikids website user?</label>
                                        <div class="col-lg-8">
                                            <input type="checkbox" name="is_kid" id="is_kid">
                                        </div>
                                    </div>


                                        </div>
                                                <div class="modal-footer">

                                                    <button type="submit" class="btn btn-primary" id="re_enrollbtn"> Enroll User</button>
						    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                                                </div>

                                            </form>

                                            </div>
                                        </div>
                                    </div>

    <!--register and enrolled modal ends    -->



 <script>
			$(document).ready( function () {
				$('#EnrolledDataTable').DataTable({
                    "ordering": false,
					"searching":false,
					"language": {
					  "info": "Showing _START_ to _END_ of _TOTAL_ Enrolled",
					  sLengthMenu: "Show _MENU_ Enrolled"
					},

					"dom": '<"top"i>rt<"bottom"flp><"clear">'
				});
			} );
 </script>


 <script>
		 // Date Picker
		jQuery('.datepicker-autoclose').datepicker({
			autoclose: true,
			todayHighlight: true
		});
        {% comment %} $(document).ready(function() {
            $('.datepicker-autoclose').each(function() {
                var startTime = $(this).data('starttime');
                if (startTime) {
                    $(this).datepicker({
                        dateFormat: 'mm/dd/yy',
                        minDate: new Date(startTime)
                    });
                } else {
                    $(this).datepicker({
                        dateFormat: 'mm/dd/yy'
                    });
                }
            });
        }); {% endcomment %}
		$(document).ready(function() {
				$('.selectInstructor').select2({
					 selectOnClose: true,
					 minimumInputLength: 2,
					 allowClear: true,
					 placeholder:"Search Student"
				});
			});



		//  jQuery('.timepicker').timepicker({
		// 	minuteStep: 15,
		// 	icons: {
		// 		up: 'zmdi zmdi-chevron-up',
		// 		down: 'zmdi zmdi-chevron-down'
		// 		}
		// 	});
 </script>


<script>

$('#SelectedCourseId').on('change', function () {
    const courseId = this.value;

    if (courseId) {
        $.ajax({
            type: "GET",
            url: `/yoshimitsujpinfy/admin_get_course_batch/`,
            data: { CourseId: courseId },
            beforeSend: function () {
                $("#selectedBatchId").html('<option value="">Loading...</option>');
            },
            success: function (response) {
                if (response.length === 0) {
                    $("#selectedBatchId").html('<option value="">Batch is not created yet for this course..</option>');
                    $('#enrollbtn').prop('disabled', true);
                } else {
                    let options = '<option value="">Select a batch</option>';
                    response.forEach(batch => {
                        options += `<option value="${batch.id}">${batch.name}</option>`;
                    });
                    $("#selectedBatchId").html(options).prop('disabled', false);
                    $('#enrollbtn').prop('disabled', false);
                }
            },
            error: function () {
                $("#selectedBatchId").html('<option value="">Error fetching batches. Try again.</option>');
                $('#enrollbtn').prop('disabled', true);
            }
        });
    } else {
        $("#selectedBatchId").html('<option value="">Please select course first</option>').prop('disabled', true);
        $('#enrollbtn').prop('disabled', true);
    }
});


</script>


<script>


$('#bulkcourses').on('change', function () {
    const courseId = this.value;

    if (courseId) {
        $.ajax({
            type: "GET",
            url: `/yoshimitsujpinfy/admin_get_course_batch/`,
            data: { CourseId: courseId },
            beforeSend: function () {
                $("#bulkselectedBatchId").html('<option value="">Loading...</option>');
            },
            success: function (response) {
                if (response.length === 0) {
                    $("#bulkselectedBatchId").html('<option value="">Batch is not created yet for this course..</option>');
                    $('#enrollbtn').prop('disabled', true);
                } else {
                    let options = '<option value="">Select a batch</option>';
                    response.forEach(batch => {
                        options += `<option value="${batch.id}">${batch.name}</option>`;
                    });
                    $("#bulkselectedBatchId").html(options).prop('disabled', false);
                    $('#enrollbtn').prop('disabled', false);
                }
            },
            error: function () {
                $("#bulkselectedBatchId").html('<option value="">Error fetching batches. Try again.</option>');
                $('#enrollbtn').prop('disabled', true);
            }
        });
    } else {
        $("#bulkselectedBatchId").html('<option value="">Please select course first</option>').prop('disabled', true);
        $('#enrollbtn').prop('disabled', true);
    }
});


</script>



<script>

$('#re_SelectedCourseId').on('change', function () {

const courseId = this.value;
console.log(courseId);


if (courseId) {
    $.ajax({
        type: "GET",
        url: `/yoshimitsujpinfy/admin_get_course_batch/`,
        data: { CourseId: courseId },
        beforeSend: function () {
            $("#re_selectedBatchId").html('<option value="">Loading...</option>');
        },
        success: function (response) {
            console.log("lenght",response.length);
            
            if (response.length === 0) {
                $("#re_selectedBatchId").html('<option value="">Batch is not created yet for this course..</option>');
                $('#re_enrollbtn').prop('disabled', true);
            } else {
                let options = '<option value="">Select a batch</option>';
                response.forEach(batch => {
                    options += `<option value="${batch.id}">${batch.name}</option>`;
                });
                $("#re_selectedBatchId").html(options).prop('disabled', false);
                $('#re_enrollbtn').prop('disabled', false);
            }
        },
        error: function () {
            $("#re_selectedBatchId").html('<option value="">Error fetching batches. Try again.</option>');
            $('#re_enrollbtn').prop('disabled', true);
        }
    });
} else {
    $("#re_selectedBatchId").html('<option value="">Please select course first</option>').prop('disabled', true);
    $('#re_enrollbtn').prop('disabled', true);
}
});

</script>


<script>

    $(document).ready(function() {
		$('.selectemail').select2({

			ajax: {
                url: '/yoshimitsujpinfy/admin_learner_profile_search_suggestions',
                dataType: 'json',

                data: function (params) {
                    return {
                        Value: params.term, // search term

                    };
                },

                processResults: function (data) {

                    return {
                        results: data
                    };
                }
            },


            selectOnClose: true,
			minimumInputLength: 1,
			allowClear: true,
			placeholder:"Search by first name , last name , email"

		});
	});

</script>


<script>

    $(document).ready(function() {
		$('.selectCourse').select2({

		ajax: {
                url: '/yoshimitsujpinfy/admin_course_search_suggestions',
                dataType: 'json',

                data: function (params) {
                    var query = {
                        Value: params.term // search term
                    };

                    if ($(this).attr('exclude-one-to-one') === '1') {
                        query.exclude_one_to_one_course = 1;
                    }

                    return query;
                },

                processResults: function (data) {

                    return {
                        results: data
                    };
                }
            },


            selectOnClose: true,
			minimumInputLength: 1,
			allowClear: true,
			placeholder:"Search by course name"

		});
	});

</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var startDateInput = document.getElementById('AllowEnrollmentStartDate');
        var endDateInput = document.getElementById('EnrollmentEndDate');

        function updateStartDateMax() {
            var endDate = endDateInput.value;
            if (endDate) {
                // Calculate one day before the selected end date
                var endDateObj = new Date(endDate);
                endDateObj.setDate(endDateObj.getDate() - 1);
                var maxDate = endDateObj.toISOString().split('T')[0]; // Format to yyyy-mm-dd
                startDateInput.setAttribute('max', maxDate);
            } else {
                startDateInput.removeAttribute('max');
            }
        }

        function updateEndDateMin() {
            var startDate = startDateInput.value;
            if (startDate) {
                endDateInput.setAttribute('min', startDate);
            }
        }

        // Update start date max when end date changes
        endDateInput.addEventListener('change', updateStartDateMax);

        // Update end date min when start date changes
        startDateInput.addEventListener('change', updateEndDateMin);

        // Ensure end date is always after start date
        endDateInput.addEventListener('change', function() {
            var startDate = startDateInput.value;
            var endDate = endDateInput.value;
            if (startDate && endDate && new Date(endDate) <= new Date(startDate)) {
                alert('Enrollment End Date must be after the Allow Enrollment Start Date.');
                endDateInput.value = ''; // Clear the invalid end date
            }
        });

        // Initialize date restrictions on page load
        updateStartDateMax();
        updateEndDateMin();
    });
</script>


{% endblock %}